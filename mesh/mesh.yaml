# For full reference for Mesh Definition visit: https://www.streamx.dev/guides/streamx-mesh-yaml-reference.html

# Change Me
defaultRegistry: ghcr.io/streamx-dev/streamx-project-template
defaultImageTag: latest-jvm

# Sources defines channels that ingestors are allowed to ingest. For more visit: https://www.streamx.dev/guides/streamx-mesh-yaml-reference.html#sources
sources:
  cli:
    outgoing:
      - "products"

ingestion:
  rest-ingestion:
    environmentFrom:
      configs:
        - "ingestion.properties"

processing:
  relay:
    image: relay-processing-service
    incoming:
      products:
        topic: inboxes/products
    outgoing:
      relayed-products:
        topic: outboxes/products
  json-converter:
    image: json-converter-processing-service
    incoming:
      products:
        topic: inboxes/products
    outgoing:
      jsons:
        topic: outboxes/jsons
  template:
    image: template-processing-service
    incoming:
      products:
        topic: inboxes/products
    outgoing:
      pages:
        topic: outboxes/pages

delivery:
  graphql:
    image: graphql-delivery-service
    incoming:
      products:
        topic: outboxes/products
    port: 8084
  web:
    image: web-delivery-service
    incoming:
      pages:
        topic: outboxes/pages
      jsons:
        topic: outboxes/jsons
    port: 8081
